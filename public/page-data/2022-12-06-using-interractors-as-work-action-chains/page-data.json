{"componentChunkName":"component---src-templates-blog-post-js","path":"/2022-12-06-using-interractors-as-work-action-chains/","result":{"data":{"site":{"siteMetadata":{"title":"Jackie's Blog"}},"markdownRemark":{"id":"19029e39-c0e6-50ac-818e-dae851b15caa","excerpt":"I. Giới thiệu về gem Interactor II. Áp dụng vào Rails III. Quy định một cấu trúc cho business logics IV. Giải thích thêm về gem Interactor V. Ví dụ I. Giới…","html":"<blockquote>\n<ul>\n<li><a href=\"#1_intro\">I. Giới thiệu về gem Interactor</a></li>\n<li><a href=\"#2_apply\">II. Áp dụng vào Rails</a></li>\n<li><a href=\"#3_structure\">III. Quy định một cấu trúc cho business logics</a></li>\n<li><a href=\"#4_explain\">IV. Giải thích thêm về gem Interactor</a></li>\n<li><a href=\"#5_coding_example\">V. Ví dụ</a></li>\n</ul>\n</blockquote>\n<h2 id=\"a-name1_introai-giới-thiệu-về-gem-interactor\" style=\"position:relative;\"><a href=\"#a-name1_introai-gi%E1%BB%9Bi-thi%E1%BB%87u-v%E1%BB%81-gem-interactor\" aria-label=\"a name1_introai giới thiệu về gem interactor permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a name=\"1_intro\"></a>I. Giới thiệu về gem Interactor</h2>\n<p>Gem <a href=\"https://github.com/collectiveidea/interactor\">Interactor</a> sẽ là nhân vật chính của chúng ta ngày hôm nay.\nViệc sử dụng Design Pattern là một việc rất phổ biến trong lập trình OOP nói riêng và lập trình nói chung. Và việc module hóa cộng với việc tái sử dụng là một trong các mục tiêu mà chúng ta thường hướng tới trong lập trình.</p>\n<p>Trong bài này chúng ta sẽ module hóa các business logic trong Rails nhằm tăng khả năng tái sử dụng thông qua việc dùng gem <code class=\"language-text\">Interactor</code></p>\n<h2 id=\"a-name2_applyaii-áp-dụng-vào-rails\" style=\"position:relative;\"><a href=\"#a-name2_applyaii-%C3%A1p-d%E1%BB%A5ng-v%C3%A0o-rails\" aria-label=\"a name2_applyaii áp dụng vào rails permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a name=\"2_apply\"></a>II. Áp dụng vào Rails</h2>\n<p>Cấu trúc thường thấy ở Rails là MVC (Model - View - Controller), ở mô hình này ta thường đặt các business logic ở trong Model, khi business logic ở Model trở nên phức tạp và phình to ra thì ta tái cấu trúc và chuyển các business logics này qua các module khác như <code class=\"language-text\">Services</code>, <code class=\"language-text\">Decorators</code> …</p>\n<p>Việc đặt các logic/code gì ở thư mục Services/Decorators … được quy định và thống nhất ở các thành viên trong team. Trong bài post này, chúng ta sẽ đặt các business logics vào trong thư mục <code class=\"language-text\">Interactors</code></p>\n<h2 id=\"a-name3_structureaiii-quy-định-cấu-trúc-cho-business-logics\" style=\"position:relative;\"><a href=\"#a-name3_structureaiii-quy-%C4%91%E1%BB%8Bnh-c%E1%BA%A5u-tr%C3%BAc-cho-business-logics\" aria-label=\"a name3_structureaiii quy định cấu trúc cho business logics permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a name=\"3_structure\"></a>III. Quy định cấu trúc cho business logics</h2>\n<p>Dưới đây là cấu trúc tổng quan trong thư mục <code class=\"language-text\">interactor</code></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">app\n│\n│\n└─── interactors\n|   |\n|   └─── &lt;business module 1>\n|   |   |\n|   |   └─── actions\n|   |   |\n|   |   └─── flows\n|   |\n|   └─── &lt;business module 2>\n|       |\n|       └─── actions\n|       |\n|       └─── flows\n|\n|</code></pre></div>\n<ul>\n<li>Mỗi <strong>Business Module</strong> đại diện cho 1 nhóm các business logic có liên quan với nhau như:\n<ul>\n<li><code class=\"language-text\">UsersBusiness</code>: gồm các hành động liên quan tới User như tạo User, cập nhật thông tin User …</li>\n<li><code class=\"language-text\">NotificationsBusiness</code>: thông báo qua email, thông báo qua tin nhắn …</li>\n</ul>\n</li>\n<li>Mỗi <strong>Action</strong> là 1 action riêng lẻ cho 1 business action cố định, một action phải duy nhất và độc lập: tạo User, cập nhật User …</li>\n<li>Mỗi <strong>Flow</strong> là sự kết hợp từ 2 actions trở lên để phục vụ cho 1 mục đích cụ thể.</li>\n</ul>\n<p>Ví dụ:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">app\n│\n│\n└─── interactors\n|   |\n|   └─── users_business\n|   |   |\n|   |   └─── actions\n|   |   |   |\n|   |   |   └─── create_user.rb\n|   |   |   |\n|   |   |   └─── update_user.rb\n|   |   |   |\n|   |   |   └─── delete_user.rb\n|   |   |\n|   |   └─── flows\n|   |       |\n|   |       └─── create_user_and_notify.rb\n|   |\n|   └─── notify_business\n|       |\n|       └─── actions\n|           |\n|           └─── notify_new_user_via_email.rb\n|           |\n|           └─── notify_via_sms.rb\n|\n|</code></pre></div>\n<h2 id=\"a-name4_explainaiv-giải-thích-thêm-về-gem-interactor\" style=\"position:relative;\"><a href=\"#a-name4_explainaiv-gi%E1%BA%A3i-th%C3%ADch-th%C3%AAm-v%E1%BB%81-gem-interactor\" aria-label=\"a name4_explainaiv giải thích thêm về gem interactor permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a name=\"4_explain\"></a>IV. Giải thích thêm về gem Interactor</h2>\n<p>Vui lòng đọc document của gem <a href=\"https://github.com/collectiveidea/interactor\">https://github.com/collectiveidea/interactor</a> để nắm bắt các ý tưởng chính như:</p>\n<ul>\n<li>context: chứa đựng tất các input, output, state của interactor</li>\n<li>failure: cách để raise failure trong một interactor</li>\n<li>hooks: các callbacks/hooks</li>\n<li>interactor: là thành phần cơ bản và quan trọng nhất, mỗi interactor thực hiện chỉ 1 mục đích và ko phụ thuộc vào bất kỳ interactor nào khác.</li>\n<li>organizer: kết hợp nhiều interactor làm việc cùng nhau.</li>\n</ul>\n<h2 id=\"a-name5_coding_exampleav-ví-dụ-code\" style=\"position:relative;\"><a href=\"#a-name5_coding_exampleav-v%C3%AD-d%E1%BB%A5-code\" aria-label=\"a name5_coding_exampleav ví dụ code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a name=\"5_coding_example\"></a>V. Ví dụ code</h2>\n<p>Code cho cấu trúc ở trên: tạo một user và notify qua email</p>\n<h4 id=\"0-cài-đặt-gem-vào-rails\" style=\"position:relative;\"><a href=\"#0-c%C3%A0i-%C4%91%E1%BA%B7t-gem-v%C3%A0o-rails\" aria-label=\"0 cài đặt gem vào rails permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>0. Cài đặt gem vào Rails</h4>\n<blockquote>\n<p>Cài đặt vào Gemfile và bundle</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gem 'interactor'</code></pre></div>\n<h4 id=\"1-ở-controller\" style=\"position:relative;\"><a href=\"#1-%E1%BB%9F-controller\" aria-label=\"1 ở controller permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Ở Controller</h4>\n<h6 id=\"a-set-up-để-bắt-exception-từ-controller\" style=\"position:relative;\"><a href=\"#a-set-up-%C4%91%E1%BB%83-b%E1%BA%AFt-exception-t%E1%BB%AB-controller\" aria-label=\"a set up để bắt exception từ controller permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>a) Set up để bắt exception từ controller</h6>\n<blockquote>\n<p>Tạo exception mới</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># app/exceptions/business_failed_error.rb</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">BusinessFailedError</span> <span class=\"token operator\">&lt;</span> StandardError\n  attr_reader <span class=\"token symbol\">:error_details</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">initialize</span></span><span class=\"token punctuation\">(</span>result <span class=\"token operator\">=</span> <span class=\"token keyword\">nil</span><span class=\"token punctuation\">,</span> msg <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">''</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token variable\">@error_details</span> <span class=\"token operator\">=</span> result<span class=\"token punctuation\">.</span>error_details\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<blockquote>\n<p>Tạo concern để bắt exception</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># app/controllers/concerns/api/catch_controller_errors.rb</span>\n<span class=\"token keyword\">module</span> <span class=\"token class-name\">Api</span><span class=\"token double-colon punctuation\">::</span>CatchControllerErrors\n  <span class=\"token keyword\">extend</span> ActiveSupport<span class=\"token double-colon punctuation\">::</span>Concern\n\n  included <span class=\"token keyword\">do</span>\n    rescue_from BusinessFailedError<span class=\"token punctuation\">,</span> <span class=\"token symbol\">with</span><span class=\"token operator\">:</span> <span class=\"token symbol\">:handle_business_errors</span>\n  <span class=\"token keyword\">end</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">handle_business_errors</span></span><span class=\"token punctuation\">(</span>exception<span class=\"token punctuation\">)</span>\n    errors <span class=\"token operator\">=</span> exception<span class=\"token punctuation\">.</span>error_details\n\n    render json<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token symbol\">errors</span><span class=\"token operator\">:</span> errors <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">status</span><span class=\"token operator\">:</span> <span class=\"token symbol\">:bad_request</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<blockquote>\n<p>Chúng ta có thể gắn concern vừa tạo ở trên vào BaseController hoặc bất cứ controller nào mà ta muốn</p>\n</blockquote>\n<h6 id=\"b-tạo-một-action-endpoint-để-tạo-user-ở-controller\" style=\"position:relative;\"><a href=\"#b-t%E1%BA%A1o-m%E1%BB%99t-action-endpoint-%C4%91%E1%BB%83-t%E1%BA%A1o-user-%E1%BB%9F-controller\" aria-label=\"b tạo một action endpoint để tạo user ở controller permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>b) Tạo một action endpoint để tạo user ở Controller</h6>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">module</span> <span class=\"token class-name\">V1</span><span class=\"token double-colon punctuation\">::</span><span class=\"token constant\">API</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">UsersController</span>\n    <span class=\"token keyword\">include</span> Api<span class=\"token double-colon punctuation\">::</span>CatchControllerErrors\n\n    <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">create</span></span>\n      ApplicationRecord<span class=\"token punctuation\">.</span>transaction <span class=\"token keyword\">do</span>\n        <span class=\"token variable\">@result</span> <span class=\"token operator\">=</span> UsersBusiness<span class=\"token double-colon punctuation\">::</span>Flows<span class=\"token double-colon punctuation\">::</span>CreateUserAndNotify<span class=\"token punctuation\">.</span>call<span class=\"token punctuation\">(</span>\n          <span class=\"token symbol\">user_params</span><span class=\"token operator\">:</span> params<span class=\"token punctuation\">.</span>to_unsafe_hash\n        <span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">raise</span> <span class=\"token class-name\">BusinessFailedError</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token variable\">@result</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unless</span> <span class=\"token variable\">@result</span><span class=\"token punctuation\">.</span>success<span class=\"token operator\">?</span>\n      <span class=\"token keyword\">end</span>\n\n      render json<span class=\"token operator\">:</span> <span class=\"token variable\">@result</span><span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span>to_json<span class=\"token punctuation\">,</span> <span class=\"token symbol\">status</span><span class=\"token operator\">:</span> <span class=\"token symbol\">:ok</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<blockquote>\n<p><strong>Lưu ý</strong>: Ta có thể thấy trong <code class=\"language-text\">create</code> action ở trên ta bọc Flow CreateUserAndNotify trong 1 transaction, đây là best practice, ta chỉ nên bọc transaction bên ngoài chứ ko nên sử dụng bên trong các interactor để tránh các nested commits ngoài ý muốn.</p>\n</blockquote>\n<h3 id=\"2-ở-interactors\" style=\"position:relative;\"><a href=\"#2-%E1%BB%9F-interactors\" aria-label=\"2 ở interactors permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Ở Interactors</h3>\n<h6 id=\"a-tạo-action-ở-users-business\" style=\"position:relative;\"><a href=\"#a-t%E1%BA%A1o-action-%E1%BB%9F-users-business\" aria-label=\"a tạo action ở users business permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>a) Tạo action ở Users business</h6>\n<blockquote>\n<p>Implement action để tạo user</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">module</span> <span class=\"token class-name\">UsersBusiness</span>\n  <span class=\"token keyword\">module</span> <span class=\"token class-name\">Actions</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">CreateUser</span>\n      <span class=\"token keyword\">include</span> Interactor\n\n      <span class=\"token comment\"># required params</span>\n      <span class=\"token comment\"># - user_params - a hash of user info</span>\n      <span class=\"token comment\">#</span>\n      <span class=\"token comment\"># output params</span>\n      <span class=\"token comment\"># - user - a User instance of the newly created user</span>\n      <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">call</span></span>\n        context<span class=\"token punctuation\">.</span>user <span class=\"token operator\">=</span> create_user<span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>user_params<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">end</span>\n\n      <span class=\"token keyword\">private</span>\n\n      <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">create_user</span></span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>validated_user_params<span class=\"token punctuation\">)</span>\n        User<span class=\"token punctuation\">.</span>create<span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>validated_user_params<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">rescue</span> StandardError <span class=\"token operator\">=></span> e\n        context<span class=\"token punctuation\">.</span>fail<span class=\"token operator\">!</span><span class=\"token punctuation\">(</span><span class=\"token symbol\">error_details</span><span class=\"token operator\">:</span> e<span class=\"token punctuation\">.</span>messages <span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<h6 id=\"b-tạo-action-ở-notifications-business\" style=\"position:relative;\"><a href=\"#b-t%E1%BA%A1o-action-%E1%BB%9F-notifications-business\" aria-label=\"b tạo action ở notifications business permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>b) Tạo action ở Notifications business</h6>\n<blockquote>\n<p>Implement action để tạo user</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">module</span> <span class=\"token class-name\">NotificationsBusiness</span>\n  <span class=\"token keyword\">module</span> <span class=\"token class-name\">Actions</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">NotifyNewUserViaEmail</span>\n      <span class=\"token keyword\">include</span> Interactor\n\n      <span class=\"token comment\"># required params</span>\n      <span class=\"token comment\"># - email - an email of a newly created user</span>\n      <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">call</span></span>\n        notify_new_user_via_email\n      <span class=\"token keyword\">end</span>\n\n      <span class=\"token keyword\">private</span>\n\n      <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">email_params</span></span>\n        <span class=\"token punctuation\">{</span>\n          <span class=\"token symbol\">to</span><span class=\"token operator\">:</span> context<span class=\"token punctuation\">.</span>email\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">end</span>\n\n      <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">notify_new_user_via_email</span></span>\n        UserMailer<span class=\"token punctuation\">.</span>notify_newly_created_user<span class=\"token punctuation\">(</span>email_params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>deliver\n      <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<h6 id=\"c-tạo-flow-kết-hợp-2-actions-ở-users-business\" style=\"position:relative;\"><a href=\"#c-t%E1%BA%A1o-flow-k%E1%BA%BFt-h%E1%BB%A3p-2-actions-%E1%BB%9F-users-business\" aria-label=\"c tạo flow kết hợp 2 actions ở users business permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>c) Tạo flow kết hợp 2 actions ở Users business</h6>\n<blockquote>\n<p>Implement flow để tạo user và notify user</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">module</span> <span class=\"token class-name\">UsersBusiness</span>\n  <span class=\"token keyword\">module</span> <span class=\"token class-name\">Flow</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">CreateUserAndNotify</span>\n      <span class=\"token keyword\">include</span> Interactor<span class=\"token double-colon punctuation\">::</span>Organizer\n\n      organize UsersBusiness<span class=\"token double-colon punctuation\">::</span>Actions<span class=\"token double-colon punctuation\">::</span>CreateUser<span class=\"token punctuation\">,</span>\n               NotificationsBusiness<span class=\"token double-colon punctuation\">::</span>Actions<span class=\"token double-colon punctuation\">::</span>NotifyNewUserViaEmail\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>","frontmatter":{"title":"Sử dụng gem Interactor để xây dựng các actions có tính tái sử dụng cao","date":"December 06, 2022","description":"Xây dựng các action hoặc flow of actions có tính tái sử dụng cao"}},"previous":{"fields":{"slug":"/2022-12-05-top-10-mistakes-that-rails-programmers-make/"},"frontmatter":{"title":"10 Sai lầm Rail Developer hay mắc phải"}},"next":{"fields":{"slug":"/2022-12-14-multi-tasks-in-ruby-say-hi-to-thread-fiber-ractor/"},"frontmatter":{"title":"Đa tác vụ trong Ruby - Gửi lời chào tới Thread, Fiber và Ractor"}}},"pageContext":{"id":"19029e39-c0e6-50ac-818e-dae851b15caa","previousPostId":"010b219d-c2e8-5f87-8381-56db794752e3","nextPostId":"07b628ec-8bd8-5e3d-a145-0fa156dc7037"}},"staticQueryHashes":["230163734","2841359383"],"slicesMap":{}}